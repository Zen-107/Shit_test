<!-- story-view.html  ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏™‡∏ï‡∏≠‡∏£‡∏µ‡πà‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏° ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏õ‡∏Å ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ ‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡πá‡∏Å-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Gift Finder | Story Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="assets/css/global.css" />
  <link rel="stylesheet" href="assets/css/stories.css" />

  <link rel="stylesheet" href="assets/css/story-view.css">
</head>

<body>
<!-- ‡∏£‡∏≠‡πÅ‡∏Å‡πâ -->
  <header class="navbar">
    <div class="container nav-content">
      <a class="logo" href="index.html">üéÅ Gift Finder</a>
    </div>
  </header>
<!-- ‡∏£‡∏≠‡πÅ‡∏Å‡πâ -->
<div class="story-top-bar"> <!-- ‡πÅ‡∏ñ‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ stories -->
    <a href="stories.html" class="back-link">‚Üê Back to Stories</a>
  </div>

<!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∏‡∏î -->
  <main class="story-view-container">

<!-- Complete! -->
    <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠‡∏¢‡∏ã‡πâ‡∏≤‡∏¢ -->
    <article class="story-card" data-story-id="story-001" data-likes-base="18">
      <!-- ‡∏£‡∏π‡∏õ‡∏õ‡∏Å‡πÉ‡∏´‡∏ç‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô -->
      <figure class="story-cover">
        <img src="uploads/covers/sample-cover.jpg" alt="Story cover">
      </figure>

      <h2 class="story-title">How I Found the Perfect Giftttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt</h2>
      <!-- ‡πÅ‡∏ñ‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô / ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î -->
      <section class="actoin-row">
        <div class="story-meta-left">
          <span class="story-author">by <strong><a href="stories.php?tag=birthday" >Naizzz </a></strong></span>
          <span class="story-date">27 November 2018</span>
        </div>

        <div class="story-actions">
          <!-- ‡∏õ‡∏∏‡πà‡∏° Like ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç -->
          <button class="pill-btn js-like-btn">
            <span class="pill-count js-like-count">18</span>
            <span class="pill-icon js-like-icon">‚ô°</span>
          </button>

          <!-- ‡∏õ‡∏∏‡πà‡∏° Save -->
          <button class="pill-btn js-save-btn">
            <span class="pill-icon js-save-icon">‚òÜ</span> 
          </button>

          <!-- ‡∏õ‡∏∏‡πà‡∏° Share -->
          <button class="pill-btn js-share-btn">
            <span class="pill-icon">‚§¥</span>
            <span class="pill-label">Share</span>
          </button>
        </div>
      </section>

      <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á -->
      <section class="story-body">
        <p>
          I always struggle to find gifts, but this time I tried using our Gift Finder
          filters to narrow down budget, interest, and personality‚Ä¶
        </p>
        <p>
          First, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyy
        </p>
<!-- ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ echo ‡∏à‡∏≤‡∏Å PHP + ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô render_story_body ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô -->
      </section>

      <!-- ‡πÅ‡∏ó‡πá‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á -->
      <section class="story-tags">
        <div class="tags-label">Tags:</div>
        <div class="tags-list">
          <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á tag ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏° -->
          <a href="stories.php?tag=birthday" class="tag-chip">#birthday</a>
          <a href="stories.php?tag=friend" class="tag-chip">#friend</a>
          <a href="stories.php?tag=low%20budget" class="tag-chip">#low&nbsp;budget</a>
          <a href="stories.php?tag=stationery" class="tag-chip">#stationery</a>
          <a href="stories.php?tag=surprise" class="tag-chip">#surprise</a>
          <a href="stories.php?tag=birthday" class="tag-chip">#birthday</a>
          <a href="stories.php?tag=friend" class="tag-chip">#friend</a>
          <a href="stories.php?tag=low%20budget" class="tag-chip">#low&nbsp;budget</a>
          <a href="stories.php?tag=stationery" class="tag-chip">#stationery</a>
          <a href="stories.php?tag=surprise" class="tag-chip">#surprise</a>
        </div>
      </section>
    </article>

    <!-- right-aside ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ story ‡∏≠‡∏∑‡πà‡∏ô -->
    <aside class="right-aside">
      <h3>More stories</h3>

      <div id="suggestions-grid" class="suggestions-grid">
        <!-- JS ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏° popular stories ‡πÅ‡∏ö‡∏ö‡∏´‡∏ô‡πâ‡∏≤ index -->
      </div>
       
    </aside>
  </main>
  
<!-- ‡∏£‡∏≠‡πÅ‡∏Å‡πâ -->
<!-- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• mock POSTS ‡∏à‡∏≤‡∏Å data.js ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ index -->
  <script src="assets/js/data.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("suggestions-grid");
    if (!container || typeof POSTS === "undefined") return;

    // ‡πÄ‡∏≠‡∏≤ 3 ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å‡πÅ‡∏ö‡∏ö‡∏´‡∏ô‡πâ‡∏≤ index
    const popular = POSTS.slice(0, 3);

    container.innerHTML = popular
      .map(
        (p) => `
        <div class="popular-card">
          <a href="story-view.html" class="popular-card-link">
            <img src="${p.image}" alt="${p.title}">
            <!-- ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô: ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏•‡∏Ñ‡πå --> 
            <div class="popular-like-badge">
              ${p.likes ?? 0} ‚ù§
            </div>
            <div class="popular-card-title">${p.title}</div>
          </a> 
        </div>
      `
      )
      .join("");
  });
  </script>

<!-- ‡∏£‡∏≠‡πÅ‡∏Å‡πâ -->
  <!-- JS like / save / share -->
  <script>
    const STORAGE_KEY = 'gf_story_actions';

    function loadStoryActions() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : {};
      } catch (e) {
        console.error('Cannot read story actions from storage', e);
        return {};
      }
    }

    function saveStoryActions(actions) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(actions));
      } catch (e) {
        console.error('Cannot save story actions', e);
      }
    }

    function getStoryState(storyId) {
      const all = loadStoryActions();
      return all[storyId] || { liked: false, saved: false };
    }

    function setStoryState(storyId, newState) {
      const all = loadStoryActions();
      all[storyId] = newState;
      saveStoryActions(all);
    }

    function updateLikeUI(storyEl, state) {
  const likeBtn   = storyEl.querySelector('.js-like-btn');
  const likeIcon  = storyEl.querySelector('.js-like-icon');
  const likeCount = storyEl.querySelector('.js-like-count');

  if (!likeBtn) return;

  const baseLikes = parseInt(storyEl.getAttribute('data-likes-base') || '0', 10) || 0;
  const totalLikes = baseLikes + (state.liked ? 1 : 0);

  likeBtn.classList.toggle('is-active', state.liked);

  if (likeIcon)  likeIcon.textContent  = state.liked ? '‚ù§' : '‚ô°';
  if (likeCount) likeCount.textContent = totalLikes;

  // ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô tooltip ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  likeBtn.title = state.liked ? 'Liked' : 'Like';
}

function updateSaveUI(storyEl, state) {
  const saveBtn  = storyEl.querySelector('.js-save-btn');
  const saveIcon = storyEl.querySelector('.js-save-icon');

  if (!saveBtn) return;

  saveBtn.classList.toggle('is-active', state.saved);

  if (saveIcon) saveIcon.textContent = state.saved ? '‚òÖ' : '‚òÜ';

  // ‚úÖ tooltip ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  saveBtn.title = state.saved ? 'Saved' : 'Save';
}

    document.addEventListener('DOMContentLoaded', function () {
      const storyEl = document.querySelector('.story-card');
      if (!storyEl) return;

      const storyId = storyEl.getAttribute('data-story-id');
      const likeBtn = storyEl.querySelector('.js-like-btn');
      const saveBtn = storyEl.querySelector('.js-save-btn');
      const shareBtn = storyEl.querySelector('.js-share-btn');

      const state = getStoryState(storyId);
      updateLikeUI(storyEl, state);
      updateSaveUI(storyEl, state);

      if (likeBtn) {
        likeBtn.addEventListener('click', () => {
          const current = getStoryState(storyId);
          const newState = { ...current, liked: !current.liked };
          setStoryState(storyId, newState);
          updateLikeUI(storyEl, newState);
        });
      }

      if (saveBtn) {
        saveBtn.addEventListener('click', () => {
          const current = getStoryState(storyId);
          const newState = { ...current, saved: !current.saved };
          setStoryState(storyId, newState);
          updateSaveUI(storyEl, newState);
        });
      }

      if (shareBtn) {
        shareBtn.addEventListener('click', async () => {
          const url = window.location.href;

          if (navigator.share) {
            try {
              await navigator.share({
                title: document.title,
                text: 'Check out this gift story!',
                url: url
              });
            } catch (_) {}
          } else if (navigator.clipboard) {
            try {
              await navigator.clipboard.writeText(url);
              alert('Copied link to clipboard!');
            } catch (e) {
              alert('Cannot copy link, please copy manually.');
            }
          } else {
            alert('Sharing is not supported on this browser.');
          }
        });
      }
    });
  </script>
</body>
</html>
